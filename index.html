<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Monitoramento de Enchentes - Acre</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #0088cc;
            --secondary-color: #5bc0de;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --success-color: #28a745;
            --dark-color: #343a40;
            --light-color: #f8f9fa;
            --gray-color: #6c757d;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color), #006699);
            color: white;
            padding: 1.5rem 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .navbar {
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .navbar .nav-link {
            color: var(--dark-color);
            font-weight: 500;
            padding: 0.75rem 1rem;
            position: relative;
            transition: all 0.2s ease;
        }
        
        .navbar .nav-link:hover, 
        .navbar .nav-link.active {
            color: var(--primary-color);
        }
        
        .navbar .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 1rem;
            right: 1rem;
            height: 3px;
            background-color: var(--primary-color);
            border-radius: 2px 2px 0 0;
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.06);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0,0,0,0.1);
        }
        
        .card-header {
            background-color: white;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            padding: 1rem 1.25rem;
        }
        
        .stats-card {
            text-align: center;
            padding: 1.5rem;
            border-radius: 10px;
            color: white;
            height: 100%;
        }
        
        .stats-card .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 0.75rem;
        }
        
        .stats-card .stat-value {
            font-size: 2rem;
            font-weight: 700;
            line-height: 1.2;
        }
        
        .stats-card .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .stats-card.primary {
            background: linear-gradient(135deg, var(--primary-color), #006699);
        }
        
        .stats-card.warning {
            background: linear-gradient(135deg, var(--warning-color), #e6a800);
            color: white;
        }
        
        .stats-card.danger {
            background: linear-gradient(135deg, var(--danger-color), #bd2130);
        }
        
        .stats-card.success {
            background: linear-gradient(135deg, var(--success-color), #1e7e34);
        }
        
        .risco-alto {
            background-color: var(--danger-color);
            color: white;
            padding: 0.35rem 0.75rem;
            border-radius: 50px;
            font-weight: 400;
            font-size: 0.85rem;
        }
        
        .risco-medio {
            background-color: var(--warning-color);
            color: white;
            padding: 0.35rem 0.75rem;
            border-radius: 50px;
            font-weight: 400;
            font-size: 0.85rem;
        }
        
        .risco-baixo {
            background-color: var(--success-color);
            color: white;
            padding: 0.35rem 0.75rem;
            border-radius: 50px;
            font-weight: 400;
            font-size: 0.85rem;
        }
        
        .nivel-grafico {
            position: relative;
            height: 6px;
            background-color: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin: 8px 0;
        }

        .nivel-atual {
            position: absolute;
            height: 100%;
            border-radius: 3px;
        }
        
        .nivel-baixo .nivel-atual {
            background-color: var(--success-color);
        }
        
        .nivel-medio .nivel-atual {
            background-color: var(--warning-color);
        }
        
        .nivel-alto .nivel-atual {
            background-color: var(--danger-color);
        }
        
        .nivel-marker {
            position: absolute;
            height: 12px;
            width: 2px;
            top: -3px;
        }
        
        .nivel-alerta {
            background-color: var(--warning-color);
        }
        
        .nivel-inundacao {
            background-color: var(--danger-color);
        }
        
        .tendencia-subindo {
            color: var(--danger-color);
            font-weight: 600;
        }
        
        .tendencia-descendo {
            color: var(--success-color);
            font-weight: 600;
        }
        
        .municipio-card {
            cursor: pointer;
            height: 100%;
        }
        
        .municipio-card .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .municipio-card .rio-info {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .municipio-card .rio-icone {
            color: var(--primary-color);
            margin-right: 0.5rem;
        }
        
        .municipio-card .nivel-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .alerta-card {
            border-left: 5px solid;
        }
        
        .alerta-alto {
            border-left-color: var(--danger-color);
            background-color: rgba(220, 53, 69, 0.05);
        }
        
        .alerta-medio {
            border-left-color: var(--warning-color);
            background-color: rgba(255, 193, 7, 0.05);
        }
        
        .alerta-baixo {
            border-left-color: var(--success-color);
            background-color: rgba(40, 167, 69, 0.05);
        }
        
        .badge-alerta {
            font-size: 0.75rem;
            padding: 0.35em 0.65em;
            font-weight: 600;
            text-transform: uppercase;
            border-radius: 50px;
        }
        
        footer {
            background-color: var(--dark-color);
            color: white;
            padding: 3rem 0 1.5rem;
            margin-top: 3rem;
        }
        
        footer a {
            color: white;
            text-decoration: none;
            transition: color 0.2s;
        }
        
        footer a:hover {
            color: white;
            text-decoration: none;
        }
        
        footer p, 
        footer .text-white, 
        footer p.text-white, 
        footer p.text-white.fw-normal, 
        footer p.mb-0 {
            font-weight: 400 !important;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif !important;
        }
        
        .footer-link {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .footer-link i {
            width: 20px;
            margin-right: 10px;
        }
        
        .search-container {
            position: relative;
            margin-bottom: 1.5rem;
        }
        
        .search-container input {
            padding-left: 40px;
            border-radius: 50px;
            border: 1px solid #ddd;
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
        }
        
        .search-container i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-color);
        }
        
        .btn-filtro {
            border-radius: 50px;
            padding: 0.75rem 1.5rem;
            font-weight: 400;
            box-shadow: none;
            border: 1px solid #ddd;
            background-color: white;
            color: var(--dark-color);
            transition: all 0.2s;
        }
        
        .btn-filtro:hover, .btn-filtro.active {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }
        
        .btn-filtro[data-filtro="com-alertas"] {
            background-color: #f8f9fa;
            border-color: #dc3545;
            color: #dc3545;
        }
        
        .btn-filtro[data-filtro="com-alertas"].active {
            background-color: #dc3545;
            color: white;
        }
        
        .alerta-contador {
            font-size: 0.7em;
            padding: 0.25em 0.5em;
        }
        
        .dark-mode .btn-filtro[data-filtro="com-alertas"] {
            background-color: #343a40;
            border-color: #dc3545;
            color: #dc3545;
        }
        
        .modal-content {
            border-radius: 10px;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .modal-header {
            border-bottom: 1px solid rgba(0,0,0,0.05);
            padding: 1.5rem;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .modal-footer {
            border-top: 1px solid rgba(0,0,0,0.05);
            padding: 1.5rem;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 1.5rem;
        }

        .form-control, .form-select {
            padding: 0.75rem 1rem;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .form-control:focus, .form-select:focus {
            box-shadow: 0 0 0 3px rgba(0, 136, 204, 0.25);
            border-color: var(--primary-color);
        }
        
        .form-label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark-color);
        }
        
        .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            font-weight: 400;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: #006699;
            border-color: #006699;
        }
        
        .btn-outline-primary {
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-outline-primary:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .nivel-badge {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .nivel-badge-alto {
            background-color: var(--danger-color);
        }
        
        .nivel-badge-medio {
            background-color: var(--warning-color);
        }
        
        .nivel-badge-baixo {
            background-color: var(--success-color);
        }
        
        .alert {
            border-radius: 10px;
            padding: 1.25rem;
        }
        
        .contato-card {
            padding: 1.25rem;
            border-radius: 10px;
            background-color: rgba(0, 136, 204, 0.1);
            margin-bottom: 1rem;
        }
        
        .contato-card h5 {
            color: var(--primary-color);
            margin-bottom: 0.75rem;
        }
        
        .tab-pane {
            padding: 1.5rem 0;
        }
        
        .instruction-step {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            position: relative;
        }
        
        .step-number {
            position: absolute;
            top: -10px;
            left: -10px;
            width: 30px;
            height: 30px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .timeline {
            position: relative;
            padding-left: 30px;
        }
        
        .timeline::before {
            content: "";
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #e9ecef;
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 1.5rem;
        }
        
        .timeline-marker {
            position: absolute;
            left: -30px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--primary-color);
        }
        
        .timeline-date {
            font-size: 0.85rem;
            color: var(--gray-color);
            margin-bottom: 0.25rem;
        }
        
        /* Melhorias para versão móvel */
        @media (max-width: 767.98px) {
            .header {
                padding: 1rem 0;
            }
            
            .stats-card {
                margin-bottom: 1rem;
            }
            
            .navbar .nav-link.active::after {
                bottom: -2px;
            }
            
            .municipio-card .card-body {
                padding: 1rem;
            }
            
            .btn-filtro {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
                margin-bottom: 0.5rem;
            }
        }
        
        /* Acessibilidade */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--primary-color);
            color: white;
            padding: 8px;
            z-index: 100;
        }
        
        .skip-link:focus {
                top: 0;
        }
        
        /* Dark mode */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #1a1a1a;
                color: #f5f5f5;
            }
            
            .navbar, .card, .card-header {
                background-color: #2a2a2a;
                color: #f5f5f5;
            }
            
            .navbar .nav-link {
                color: #f5f5f5;
            }
            
            .form-control, .form-select, .btn-filtro {
                background-color: #333;
                border-color: #444;
                color: #f5f5f5;
            }
            
            .text-muted, .text-dark {
                color: #aaa !important;
            }
            
            .modal-content {
                background-color: #2a2a2a;
                color: #f5f5f5;
            }
            
            .instruction-step {
                background-color: #333;
            }
        }
        
        /* CSS para adicionar o ícone de alerta nos cards dos municípios */
        .alerta-card-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--danger-color);
            color: white;
            border-radius: 50%;
            padding: 6px;
            font-size: 14px;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .nivel-grafico .nivel-marker.nivel-inundacao {
            background-color: var(--danger-color);
        }
        
        /* Indicador de alerta no card */
        .alerta-indicador {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 12px;
            height: 12px;
            background-color: var(--danger-color);
            border-radius: 50%;
            animation: pulse 1.5s infinite;
            z-index: 2;
        }
        
        .dark-mode .alerta-indicador {
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
        }
        
        /* Modo Noturno */
        body.dark-mode {
            background-color: #181818;
            color: #f0f0f0;
        }
        
        .dark-mode .header {
            background: linear-gradient(135deg, #005580, #00334d);
        }
        
        .dark-mode .card {
            background-color: #222;
            color: white;
            border: 1px solid #333;
        }
        
        .dark-mode .btn-outline-light {
            color: white;
            border-color: white;
        }
        
        .dark-mode .navbar {
            background-color: #222;
            border-bottom: 1px solid #333;
        }
        
        .dark-mode .navbar .nav-link {
            color: #e0e0e0;
        }
        
        .dark-mode .navbar .nav-link:hover,
        .dark-mode .navbar .nav-link.active {
            color: white;
        }
        
        .dark-mode .card-header {
            background-color: #2a2a2a;
            border-bottom: 1px solid #333;
        }
        
        .dark-mode .text-muted {
            color: #aaa !important;
        }
        
        .dark-mode .modal-content {
            background-color: #222;
            border: 1px solid #333;
        }
        
        .dark-mode .modal-header,
        .dark-mode .modal-footer {
            border-color: #333;
        }
        
        .dark-mode .table {
            color: #e0e0e0;
        }
        
        .dark-mode .table td,
        .dark-mode .table th {
            border-color: #333;
        }
        
        .dark-mode .dropdown-menu {
            background-color: #222;
            border: 1px solid #333;
        }
        
        .dark-mode .dropdown-item {
            color: #e0e0e0;
        }
        
        .dark-mode .dropdown-item:hover {
            background-color: #333;
            color: white;
        }
        
        .dark-mode .dropdown-divider {
            border-color: #333;
        }
    </style>
</head>
<body>
    <!-- Skip to content link for accessibility -->
    <a href="#main-content" class="skip-link">Pular para o conteúdo</a>
    
    <!-- Cabeçalho -->
    <header class="header" role="banner">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <img src="https://static.wixstatic.com/media/c96204_fecf1c65eaf64f22b97b4d31736b208c~mv2.png" alt="Radar de Enchentes MPAC" class="img-fluid" style="max-height: 120px;">
            </div>
                <div class="text-end d-none d-md-block">
                    <p class="mb-0"><i class="fas fa-sync-alt me-1" aria-hidden="true"></i>Atualizado:<span id="ultima-atualizacao">13/03/2025 10:30</span></p>
                    <p class="mb-0"><small>Fonte: Defesa Civil</small></p>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Menu de navegação -->
    <nav class="navbar navbar-expand-lg sticky-top" aria-label="Menu principal">
        <div class="container">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Alternar navegação">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" href="#dashboard" data-bs-toggle="tab" role="tab" aria-selected="true">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Atuacao.html">Atuação</a>
                    </li>
                </ul>
                <div class="ms-auto d-flex align-items-center">
                    <a href="https://www.instagram.com/mpacre/" target="_blank" class="btn btn-sm btn-outline-secondary me-2" title="Instagram do MPAC">
                        <i class="fab fa-instagram" aria-hidden="true"></i>
                    </a>
                    <a href="https://www.mpac.mp.br/" target="_blank" class="btn btn-sm btn-outline-secondary me-2" title="Site do MPAC">
                        <i class="fas fa-globe" aria-hidden="true"></i>
                    </a>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-cog" aria-hidden="true"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton">
                            <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#ajuda-modal">Ajuda</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" id="toggle-dark-mode">Alternar tema</a></li>
                        </ul>
            </div>
        </div>
            </div>
        </div>
    </nav>

    <!-- Conteúdo principal -->
    <main class="container my-4" id="main-content">
        <div class="tab-content">
            <!-- Tab Dashboard -->
            <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
                <!-- Estatísticas gerais -->
                <div class="row mb-4">
                    <div class="col-md-3 col-sm-6 mb-3 mb-md-0">
                        <div class="card h-100">
                            <div class="stats-card primary">
                                <div class="stat-icon" aria-hidden="true">
                                    <i class="fas fa-map-marker-alt"></i>
                    </div>
                                <div class="stat-value">22</div>
                                <div class="stat-label">Municípios monitorados</div>
                </div>
                    </div>
                </div>
                    <div class="col-md-3 col-sm-6 mb-3 mb-md-0">
                        <div class="card h-100">
                            <div class="stats-card warning">
                                <div class="stat-icon" aria-hidden="true">
                                    <i class="fas fa-exclamation-triangle"></i>
                    </div>
                                <div class="stat-value">4</div>
                                <div class="stat-label">Municípios em alerta</div>
                </div>
                    </div>
                </div>
                    <div class="col-md-3 col-sm-6 mb-3 mb-md-0">
                        <div class="card h-100">
                            <div class="stats-card danger">
                                <div class="stat-icon" aria-hidden="true">
                                    <i class="fas fa-exclamation-circle"></i>
            </div>
                                <div class="stat-value">2</div>
                                <div class="stat-label">Municípios em risco alto</div>
        </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <div class="card h-100">
                            <div class="stats-card success">
                                <div class="stat-icon" aria-hidden="true">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="stat-value">16</div>
                                <div class="stat-label">Municípios normais</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Alerta de aviso importante (quando necessário) -->
                <div class="alert alert-warning alert-dismissible fade show mb-4" role="alert">
                    <div class="d-flex">
                        <div class="me-3">
                            <i class="fas fa-exclamation-triangle fa-2x" aria-hidden="true"></i>
                        </div>
                        <div>
                            <h4 class="alert-heading">Alerta de chuvas intensas</h4>
                            <p>Previsão de chuvas intensas nos próximos dias. Fique atento aos alertas da Defesa Civil e prepare-se para possíveis variações nos níveis dos rios.</p>
                        </div>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
                            </div>
                
                <!-- Contenedor de alertas dinâmicos -->
                <div id="alertas-container">
                    <!-- Os alertas serão carregados dinamicamente do JSON -->
                            </div>

                <!-- Lista de municípios -->
                <h2 class="mb-3">Municípios Monitorados <small class="text-muted fs-6">Clique no card para mais detalhes</small></h2>
                
                <!-- Barra de pesquisa e filtros -->
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="search-container">
                                    <i class="fas fa-search" aria-hidden="true"></i>
                                    <input type="text" id="municipio-busca" class="form-control" placeholder="Buscar município..." aria-label="Buscar município">
                    </div>
                            </div>
                            <div class="col-md-6">                
                                <div class="d-flex flex-wrap gap-2 mb-3">
                                    <button class="btn-filtro active" data-filtro="todos">Todos</button>
                                    <button class="btn-filtro" data-filtro="alto">Risco Alto</button>
                                    <button class="btn-filtro" data-filtro="medio">Risco Médio</button>
                                    <button class="btn-filtro" data-filtro="baixo">Risco Baixo</button>
                                    <button class="btn-filtro" data-filtro="com-alertas">
                                        <i class="fas fa-bell me-1" aria-hidden="true"></i> Com Alertas
                                        <span class="alerta-contador badge rounded-pill bg-danger ms-1">0</span>
                                    </button>
                            </div>
                    </div>
                </div>
            </div>
        </div>
                
                <div class="row g-3" id="lista-municipios">
                    <!-- Os cards dos municípios serão carregados aqui -->
                </div>
                
                <!-- Mensagem para quando nenhum município for encontrado -->
                <div id="mensagem-sem-resultados" style="display: none;"></div>
            </div>
            
            <!-- Tab Atuação -->
            <div class="tab-pane fade" id="atuacao" role="tabpanel">
                <div class="card mb-4">
                    <div class="card-body">
                        <h2 class="mb-4">Atuação do MPAC</h2>
                        <p>O Ministério Público do Estado do Acre (MPAC) atua de forma preventiva e repressiva na proteção do meio ambiente e na defesa dos direitos da sociedade, especialmente em situações de emergência como enchentes e desastres naturais.</p>
                        
                        <!-- Estatísticas de Atuação -->
                        <div class="row mb-4 mt-4">
                            <h4 class="mb-3">Estatísticas de Atuação</h4>
                            <div class="col-md-4 col-sm-6 mb-3">
                                <div class="card h-100" style="background-color: #8B2635; color: white; border-radius: 10px;">
                                    <div class="card-body text-center">
                                        <h6 class="card-title mb-2">Desabrigados Rio Branco</h6>
                                        <h2 class="display-4 fw-bold mb-0">309</h2>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 col-sm-6 mb-3">
                                <div class="card h-100" style="background-color: #8B2635; color: white; border-radius: 10px;">
                                    <div class="card-body text-center">
                                        <h6 class="card-title mb-2">Abrigos visitados</h6>
                                        <h2 class="display-4 fw-bold mb-0">16</h2>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 col-sm-6 mb-3">
                                <div class="card h-100" style="background-color: #8B2635; color: white; border-radius: 10px;">
                                    <div class="card-body text-center">
                                        <h6 class="card-title mb-2">Vistorias realizadas</h6>
                                        <h2 class="display-4 fw-bold mb-0">56</h2>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 col-sm-6 mb-3">
                                <div class="card h-100" style="background-color: #8B2635; color: white; border-radius: 10px;">
                                    <div class="card-body text-center">
                                        <h6 class="card-title mb-2">Demandas atendidas</h6>
                                        <h2 class="display-4 fw-bold mb-0">475</h2>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 col-sm-6 mb-3">
                                <div class="card h-100" style="background-color: #8B2635; color: white; border-radius: 10px;">
                                    <div class="card-body text-center">
                                        <h6 class="card-title mb-2">Parcialmente atendidas</h6>
                                        <h2 class="display-4 fw-bold mb-0">50</h2>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 col-sm-6 mb-3">
                                <div class="card h-100" style="background-color: #8B2635; color: white; border-radius: 10px;">
                                    <div class="card-body text-center">
                                        <h6 class="card-title mb-2">Em atendimento</h6>
                                        <h2 class="display-4 fw-bold mb-0">179</h2>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 col-sm-6 mb-3">
                                <div class="card h-100" style="background-color: #8B2635; color: white; border-radius: 10px;">
                                    <div class="card-body text-center">
                                        <h6 class="card-title mb-2">Reuniões</h6>
                                        <h2 class="display-4 fw-bold mb-0">21</h2>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <h4 class="mt-4">Principais Ações</h4>
                        <ul>
                            <li>Monitoramento e fiscalização das ações governamentais relacionadas à prevenção e resposta a desastres naturais</li>
                            <li>Promoção de ações civis públicas para garantir a proteção ambiental e a segurança da população</li>
                            <li>Articulação com órgãos públicos e sociedade civil para fortalecer a gestão de riscos</li>
                            <li>Investigação de possíveis irregularidades na gestão de recursos destinados à prevenção e resposta a desastres</li>
                        </ul>
                        
                        <div class="alert alert-info mb-4">
                            <h5><i class="fas fa-info-circle me-2"></i> Como denunciar</h5>
                            <p>Se você tiver conhecimento de irregularidades relacionadas à gestão de recursos ou ações governamentais em situações de desastres naturais, entre em contato com o MPAC:</p>
                            <p><i class="fas fa-phone me-2"></i> (68) 3213-1616</p>
                            <p><i class="fas fa-envelope me-2"></i> ouvidoria@mpac.mp.br</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Rodapé -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-4 mb-lg-0">
                    <h5 class="text-white mb-3">Sistema de Monitoramento de Enchentes</h5>
                    <p class="text-white fw-normal" style="max-width: 300px; font-weight: 400 !important; font-size: 0.90rem !important;">Sistema de monitoramento e alerta para enchentes no estado do Acre.</p>
                    </div>
                <div class="col-lg-2 col-md-4 col-6 mb-4 mb-md-0">
                    <h5 class="text-white mb-3">Links</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="#dashboard" class="footer-link" data-bs-toggle="tab"><i class="fas fa-chart-line me-2" aria-hidden="true"></i> Dashboard</a></li>
                        <li class="mb-2"><a href="#atuacao" class="footer-link" data-bs-toggle="tab"><i class="fas fa-balance-scale me-2" aria-hidden="true"></i> Atuação</a></li>
                    </ul>
                </div>
                <div class="col-lg-3 col-md-4 col-6 mb-4 mb-md-0">
                    <h5 class="text-white mb-3">Contatos de Emergência</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="tel:193" class="footer-link"><i class="fas fa-phone me-2" aria-hidden="true"></i> Bombeiros: 193</a></li>
                        <li class="mb-2"><a href="tel:68-3223-1177" class="footer-link"><i class="fas fa-phone me-2" aria-hidden="true"></i> Defesa Civil: (68) 3223-1177</a></li>
                        <li class="mb-2"><a href="tel:190" class="footer-link"><i class="fas fa-phone me-2" aria-hidden="true"></i> Polícia Militar: 190</a></li>
                        <li class="mb-2"><a href="tel:192" class="footer-link"><i class="fas fa-ambulance me-2" aria-hidden="true"></i> SAMU: 192</a></li>
                    </ul>
                </div>
                <div class="col-lg-3 col-md-4 col-sm-12">
                    <h5 class="text-white mb-3">Parceiros</h5>
                    <div class="d-flex flex-wrap gap-3">
                        <a href="#" class="text-decoration-none" aria-label="Governo do Estado do Acre">
                            <img src="https://via.placeholder.com/80x40?text=Acre" alt="Logo Governo do Acre" width="80" height="40" class="bg-white rounded p-1">
                        </a>
                        <a href="#" class="text-decoration-none" aria-label="Defesa Civil">
                            <img src="https://via.placeholder.com/80x40?text=Defesa+Civil" alt="Logo Defesa Civil" width="80" height="40" class="bg-white rounded p-1">
                        </a>
                        <a href="#" class="text-decoration-none" aria-label="Prefeitura de Rio Branco">
                            <img src="https://via.placeholder.com/80x40?text=INMET" alt="Logo Prefeitura" width="80" height="40" class="bg-white rounded p-1">
                        </a>
                    </div>
                </div>
                </div>
            <div class="border-top border-secondary pt-4 mt-4">
                <div class="row">
                    <div class="col-12 text-center">
                        <p class="text-white fw-normal mb-0" style="font-weight: 400 !important; font-size: 0.85rem !important;">&copy; 2025 Desenvolvido por Seringal Lab - Laboratório de Inovação - Todos os direitos reservados.</p>
                </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modal de Detalhes do Município -->
    <div class="modal fade" id="municipioModal" tabindex="-1" aria-labelledby="municipioModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="municipioModalLabel">Detalhes do Município</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-4">
                                <h5 class="mb-3">Informações do Rio</h5>
                                <div class="row mb-2">
                                    <div class="col-5 fw-bold">Rio:</div>
                                    <div class="col-7" id="modal-rio">--</div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-5 fw-bold">Nível Atual:</div>
                                    <div class="col-7" id="modal-nivel">--</div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-5 fw-bold">Tendência:</div>
                                    <div class="col-7" id="modal-tendencia">--</div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-5 fw-bold">Status:</div>
                                    <div class="col-7" id="modal-status">--</div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-5 fw-bold">Última Atualização:</div>
                                    <div class="col-7" id="modal-atualizacao">--</div>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h5 class="mb-3">Níveis de Referência</h5>
                                <div class="row mb-2">
                                    <div class="col-5 fw-bold">Alerta:</div>
                                    <div class="col-7" id="modal-nivel-alerta">--</div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-5 fw-bold">Inundação:</div>
                                    <div class="col-7" id="modal-nivel-inundacao">--</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="mb-4">
                                <h5 class="mb-3">Histórico das Últimas 24h</h5>
                                <div class="chart-container">
                                    <canvas id="historicoChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h5 class="mb-3">Contatos de Emergência</h5>
                                <div class="row mb-2">
                                    <div class="col-5 fw-bold">Defesa Civil:</div>
                                    <div class="col-7" id="modal-defesa-civil">(68) 3223-1177</div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-5 fw-bold">Bombeiros:</div>
                                    <div class="col-7" id="modal-bombeiros">193</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="modal-alertas-container">
                        <!-- Container para alertas específicos do município -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Variáveis globais para armazenar dados
        let dadosMunicipios = {};
        let dadosAlertas = [];
        let ultimaAtualizacao = '';
        
        // Função para gerar ID do município (slug) baseado no nome
        function gerarMunicipioId(nome) {
          if (!nome) return '';
          
          return nome.toLowerCase()
            .normalize('NFD').replace(/[\u0300-\u036f]/g, '') // Remove acentos
            .replace(/[^\w\s-]/g, '') // Remove caracteres especiais
            .replace(/\s+/g, '-') // Substitui espaços por hífens
            .replace(/-+/g, '-') // Remove hífens duplicados
            .replace(/^-+|-+$/g, ''); // Remove hífens do início e fim
        }
        
        // Função para processar dados dos municípios
        function processarDados(dados) {
          console.log("Processando dados:", dados);
          
          // Se dados é um array (formato da SheetDB API), converter para objeto
          let municipios = {};
          
          if (Array.isArray(dados)) {
            console.log("Dados recebidos como array, convertendo para objeto");
            
            dados.forEach((municipio, index) => {
              // Gerar ID a partir do nome
              const nome = municipio.Nome || municipio.nome;
              if (!nome) {
                console.warn("Município sem nome encontrado:", municipio);
                return;
              }
              
              const id = gerarMunicipioId(nome);
              console.log(`Processando município #${index}: ${nome} (ID: ${id})`);
              
              // Mapear nomes de colunas da API para as propriedades esperadas pelo código
              municipios[id] = {
                nome: nome,
                rio: municipio.Rio || municipio.rio || "Não informado",
                nivelAtual: parseFloat(municipio["Nível Atual"] || municipio.nivelAtual || 0),
                nivelAlerta: parseFloat(municipio["Nível Alerta"] || municipio.nivelAlerta || 0),
                nivelInundacao: parseFloat(municipio["Nível Inundação"] || municipio.nivelInundacao || 0),
                variacao24h: parseFloat(municipio["Variação 24h"] || municipio.variacao24h || 0),
                tendencia: (municipio.Tendência || municipio.tendencia || "estável").toLowerCase(),
                risco: (municipio.Risco || municipio.risco || "baixo").toLowerCase(),
                atualizadoEm: municipio["Atualizado Em"] || municipio.atualizadoEm || new Date().toISOString(),
                abrigos: municipio.Abrigos || municipio.abrigos || 0,
                contato: municipio.Contato || municipio.contato || "Defesa Civil",
                instrucoes: municipio.Instrucoes || municipio.instrucoes || "Siga as orientações da Defesa Civil local."
              };
              
              // Realizar verificações de qualidade de dados
              if (isNaN(municipios[id].nivelAtual)) {
                console.warn(`Nível atual inválido para ${nome}: ${municipio["Nível Atual"]}`);
                municipios[id].nivelAtual = 0;
              }
              
              if (isNaN(municipios[id].variacao24h)) {
                console.warn(`Variação 24h inválida para ${nome}: ${municipio["Variação 24h"]}`);
                municipios[id].variacao24h = 0;
              }
              
              // Log de confirmação
              console.log(`Município processado: ${nome}`, municipios[id]);
            });
          } else if (dados.municipios) {
            console.log("Dados recebidos no formato esperado (objeto)");
            municipios = dados.municipios;
          } else {
            console.warn("Formato de dados não reconhecido:", dados);
            return;
          }
          
          // Verificar se temos municípios após processamento
          const totalMunicipios = Object.keys(municipios).length;
          console.log(`Total de municípios processados: ${totalMunicipios}`);
          
          if (totalMunicipios === 0) {
            console.error("Nenhum município encontrado após processamento de dados");
            document.getElementById("lista-municipios").innerHTML = 
              '<div class="col-12 text-center py-5">' +
              '<div class="alert alert-warning">' +
              '<i class="fas fa-exclamation-triangle me-2"></i> ' +
              'Nenhum município encontrado. Verifique a conexão com a API ou tente novamente mais tarde.' +
              '</div></div>';
            return;
          }
          
          // Atualizar interface com os municípios processados
          atualizarInterface(municipios);
          
          // Armazenar dados para uso em outras funções
          window.dadosMunicipios = municipios;
          
          // Mostrar estatísticas no console
          console.log("Estatísticas de risco:");
          const riscos = Object.values(municipios).reduce((acc, mun) => {
            acc[mun.risco] = (acc[mun.risco] || 0) + 1;
            return acc;
          }, {});
          console.table(riscos);
          
          return municipios;
        }
        
        // Função para calcular nível de risco
        function calcularRisco(nivelAtual, nivelAlerta, nivelInundacao) {
          if (nivelAtual >= nivelInundacao) return 'alto';
          if (nivelAtual >= nivelAlerta) return 'medio';
          return 'baixo';
        }
        
        // Função para gerar ID de município
        function gerarMunicipioId(nome) {
          if (!nome) return `municipio-${Date.now()}`;
          
          // Normalizar nome (remover acentos, espaços extras, etc)
          return nome
            .toLowerCase()
            .normalize('NFD')
            .replace(/[\u0300-\u036f]/g, '')
            .replace(/[^\w\s]/g, '')
            .replace(/\s+/g, '-');
        }
        
        // Função para formatar data
        function formatarData(dataString) {
          if (!dataString) return 'N/A';
          
          try {
            const data = new Date(dataString);
            return data.toLocaleString('pt-BR', {
              day: '2-digit',
              month: '2-digit',
              year: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
            });
          } catch (erro) {
            console.error('Erro ao formatar data:', erro);
            return dataString;
          }
        }
        
        // Função para carregar dados dos municípios
        async function carregarDados() {
          console.log('Carregando dados dos municípios...');
          
          try {
            // Adicionar timestamp para evitar cache
            const timestamp = new Date().getTime();
            const url = `https://sheetdb.io/api/v1/jhx7c3n5n0lkg?_=${timestamp}`;
            
            // Tentar fazer fetch com CORS
            console.log('Buscando dados da API:', url);
            const resposta = await fetch(url, {
              method: 'GET',
              headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                'Cache-Control': 'no-cache',
                'Pragma': 'no-cache'
              },
              mode: 'cors',
              cache: 'no-cache'
            });
            
            if (!resposta.ok) {
              throw new Error(`Falha ao buscar dados: ${resposta.status} ${resposta.statusText}`);
            }
            
            const dados = await resposta.json();
            console.log('Dados recebidos da API:', dados);
            
            // Processar dados e atualizar interface
            const municipios = processarDados(dados);
            
            // Verificar se os dados foram processados corretamente
            if (!municipios || Object.keys(municipios).length === 0) {
              console.error('Falha ao processar dados dos municípios');
              
              // Tentar carregar dados locais como fallback
              console.log('Tentando carregar dados locais como fallback...');
              try {
                const respostaLocal = await fetch('dados.json');
                if (respostaLocal.ok) {
                  const dadosLocais = await respostaLocal.json();
                  console.log('Dados locais carregados com sucesso:', dadosLocais);
                  processarDados(dadosLocais);
                }
              } catch (erroLocal) {
                console.error('Falha ao carregar dados locais:', erroLocal);
              }
            }
            
            // Carregar alertas
            carregarAlertas();
            
            return true;
          } catch (erro) {
            console.error('Erro ao carregar dados:', erro);
            
            // Tentar método alternativo (JSONP)
            console.log('Tentando método alternativo (JSONP)...');
            try {
              const script = document.createElement('script');
              script.src = `https://sheetdb.io/api/v1/jhx7c3n5n0lkg?callback=processarDadosCallback&_=${new Date().getTime()}`;
              document.body.appendChild(script);
              
              // Definir callback global
              window.processarDadosCallback = function(dados) {
                console.log('Dados recebidos via JSONP:', dados);
                processarDados(dados);
                document.body.removeChild(script);
                delete window.processarDadosCallback;
              };
              
              return true;
            } catch (erroJSONP) {
              console.error('Erro ao usar método JSONP:', erroJSONP);
              
              // Último recurso: tentar dados locais
              console.log('Tentando carregar dados locais...');
              try {
                const respostaLocal = await fetch('dados.json');
                if (respostaLocal.ok) {
                  const dadosLocais = await respostaLocal.json();
                  console.log('Dados locais carregados com sucesso:', dadosLocais);
                  processarDados(dadosLocais);
                  return true;
                }
              } catch (erroLocal) {
                console.error('Falha ao carregar dados locais:', erroLocal);
              }
            }
            
            // Se chegou aqui, todas as tentativas falharam
            document.getElementById('lista-municipios').innerHTML = `
              <div class="col-12 text-center py-5">
                <div class="alert alert-danger">
                  <i class="fas fa-exclamation-circle me-2"></i>
                  Falha ao carregar dados. Por favor, tente novamente mais tarde.
                </div>
              </div>
            `;
            
            return false;
          }
        }
        
        // Função para atualizar a interface com os dados carregados
        function atualizarInterface(municipios) {
          console.log('Atualizando interface com municípios:', municipios);
          
          // Se não recebeu municípios como parâmetro, usar a variável global
          if (!municipios && window.dadosMunicipios) {
            municipios = window.dadosMunicipios;
          }
          
          // Verificar se temos o elemento lista-municipios
          const listaMunicipios = document.getElementById('lista-municipios');
          if (!listaMunicipios) {
            console.error('Elemento #lista-municipios não encontrado!');
            return;
          }
          
          // Limpar conteúdo atual
          listaMunicipios.innerHTML = '';
          
          // Verificar se temos municípios
          if (!municipios || Object.keys(municipios).length === 0) {
            console.warn('Nenhum município para exibir');
            listaMunicipios.innerHTML = `
              <div class="col-12 text-center py-5">
                <div class="alert alert-warning">
                  <i class="fas fa-exclamation-triangle me-2"></i>
                  Nenhum município com dados disponíveis.
                </div>
              </div>
            `;
            return;
          }
          
          // Contadores para estatísticas
          let totalMunicipios = 0;
          let riscoAlto = 0;
          let riscoMedio = 0;
          let riscoBaixo = 0;
          
          // Processar cada município e criar card
          Object.keys(municipios).forEach(municipioId => {
            const municipio = municipios[municipioId];
            
            // Validar dados essenciais
            if (!municipio || !municipio.nome) {
              console.warn(`Município ${municipioId} com dados inválidos:`, municipio);
              return;
            }
            
            // Criar card e adicionar à lista
            const cardHTML = criarCardMunicipio(municipioId, municipio);
            listaMunicipios.innerHTML += cardHTML;
            
            // Atualizar contadores
            totalMunicipios++;
            if (municipio.risco === 'alto') riscoAlto++;
            else if (municipio.risco === 'medio') riscoMedio++;
            else riscoBaixo++;
          });
          
          // Atualizar contador no cabeçalho
          const contadorElement = document.getElementById('contador-municipios');
          if (contadorElement) {
            contadorElement.textContent = totalMunicipios;
          }
          
          // Atualizar contadores de risco
          const contadorAlto = document.getElementById('contador-risco-alto');
          const contadorMedio = document.getElementById('contador-risco-medio');
          const contadorBaixo = document.getElementById('contador-risco-baixo');
          
          if (contadorAlto) contadorAlto.textContent = riscoAlto;
          if (contadorMedio) contadorMedio.textContent = riscoMedio;
          if (contadorBaixo) contadorBaixo.textContent = riscoBaixo;
          
          console.log(`Interface atualizada: ${totalMunicipios} municípios (${riscoAlto} alto, ${riscoMedio} médio, ${riscoBaixo} baixo)`);
        }
        
        // Função para fechar o modal
        function fecharModal() {
          const modal = bootstrap.Modal.getInstance(document.getElementById('municipioModal'));
          if (modal) modal.hide();
        }
        
        // Função para abrir o modal de detalhes do município
        function abrirModal(municipioId) {
          // Obter dados do município
          const municipio = dadosMunicipios[municipioId];
          if (!municipio) {
            console.error(`Município não encontrado: ${municipioId}`);
            return;
          }
          
          // Atualizar título do modal
          document.getElementById('municipioModalLabel').textContent = municipio.nome;
          
          // Atualizar informações do rio
          document.getElementById('modal-rio').textContent = municipio.rio || '--';
          document.getElementById('modal-nivel').textContent = `${municipio.nivelAtual.toFixed(2)}m`;
          
          // Atualizar tendência
          const tendenciaEl = document.getElementById('modal-tendencia');
          if (tendenciaEl) {
            let icone, classe;
            switch(municipio.tendencia) {
              case 'subindo':
                icone = 'fa-arrow-up';
                classe = 'text-danger';
                break;
              case 'descendo':
                icone = 'fa-arrow-down';
                classe = 'text-success';
                break;
              default:
                icone = 'fa-arrows-alt-h';
                classe = 'text-warning';
            }
            tendenciaEl.innerHTML = `<i class="fas ${icone} ${classe}"></i> ${municipio.tendencia.charAt(0).toUpperCase() + municipio.tendencia.slice(1)}`;
          }
          
          // Atualizar status (risco)
          const statusEl = document.getElementById('modal-status');
          if (statusEl) {
            let classe, texto;
            switch(municipio.risco) {
              case 'alto':
                classe = 'text-danger';
                texto = 'Risco Alto';
                break;
              case 'medio':
                classe = 'text-warning';
                texto = 'Risco Médio';
                break;
              default:
                classe = 'text-success';
                texto = 'Risco Baixo';
            }
            statusEl.innerHTML = `<span class="${classe} fw-bold">${texto}</span>`;
          }
          
          // Atualizar última atualização
          document.getElementById('modal-atualizacao').textContent = formatarData(municipio.atualizadoEm);
          
          // Atualizar níveis de referência
          document.getElementById('modal-nivel-alerta').textContent = `${municipio.nivelAlerta.toFixed(2)}m`;
          document.getElementById('modal-nivel-inundacao').textContent = `${municipio.nivelInundacao.toFixed(2)}m`;
          
          // Atualizar contatos
          document.getElementById('modal-defesa-civil').textContent = municipio.contatoDefesaCivil || '199';
          document.getElementById('modal-bombeiros').textContent = municipio.contatoBombeiros || '193';
          
          // Inicializar gráfico de histórico
          inicializarGrafico(municipioId);
          
          // Atualizar alertas do município
          atualizarAlertasMunicipio(municipioId);
          
          // Mostrar o modal
          const modal = new bootstrap.Modal(document.getElementById('municipioModal'));
          modal.show();
        }
        
        // Função para inicializar o gráfico de histórico
        function inicializarGrafico(municipioId) {
          const canvasEl = document.getElementById('historicoChart');
          if (!canvasEl) return;
          
          // Dados fictícios para o gráfico (poderia ser obtido da API)
          const datas = ['14/03', '15/03', '16/03', '17/03', '18/03', '19/03', '20/03'];
          const niveis = [14.8, 15.1, 15.3, 15.2, 15.1, 15.0, 15.17];
          
          // Se já existe um gráfico neste canvas, destruí-lo
          if (canvasEl.chart) {
            canvasEl.chart.destroy();
          }
          
          // Criar novo gráfico
          const municipio = dadosMunicipios[municipioId];
          if (!municipio) return;
          
          const ctx = canvasEl.getContext('2d');
          canvasEl.chart = new Chart(ctx, {
            type: 'line',
            data: {
              labels: datas,
              datasets: [{
                label: 'Nível do Rio (m)',
                data: niveis,
                borderColor: '#0088cc',
                backgroundColor: 'rgba(0, 136, 204, 0.1)',
                borderWidth: 2,
                fill: true,
                tension: 0.1
              }, {
                label: 'Nível de Alerta',
                data: Array(datas.length).fill(municipio.nivelAlerta),
                borderColor: '#ffc107',
                borderWidth: 2,
                borderDash: [5, 5],
                fill: false,
                pointRadius: 0
              }, {
                label: 'Nível de Inundação',
                data: Array(datas.length).fill(municipio.nivelInundacao),
                borderColor: '#dc3545',
                borderWidth: 2,
                borderDash: [5, 5],
                fill: false,
                pointRadius: 0
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  position: 'top',
                },
                tooltip: {
                  mode: 'index',
                  intersect: false
                }
              },
              scales: {
                y: {
                  beginAtZero: false,
                  title: {
                    display: true,
                    text: 'Nível (metros)'
                  }
                }
              }
            }
          });
        }
        
        // Função para atualizar alertas do município
        function atualizarAlertasMunicipio(municipioId) {
          const alertasEl = document.getElementById('modal-alertas-container');
          if (!alertasEl) return;
          
          // Limpar alertas anteriores
          alertasEl.innerHTML = '';
          
          // Verificar se há alertas para este município
          const alertasMunicipio = dadosAlertas.filter(alerta => alerta.municipioId === municipioId);
          
          if (alertasMunicipio.length === 0) {
            alertasEl.innerHTML = `
              <div class="alert alert-info mt-4">
                <i class="fas fa-info-circle me-2"></i> Não há alertas ativos para este município.
              </div>
            `;
            return;
          }
          
          // Adicionar título para os alertas
          alertasEl.innerHTML = `<h5 class="mt-4 mb-3">Alertas Ativos</h5>`;
          
          // Adicionar cada alerta
          alertasMunicipio.forEach(alerta => {
            let classeAlerta, iconeAlerta;
            switch(alerta.nivel) {
              case 'alto':
                classeAlerta = 'danger';
                iconeAlerta = 'exclamation-triangle';
                break;
              case 'medio':
                classeAlerta = 'warning';
                iconeAlerta = 'exclamation-circle';
                break;
              default:
                classeAlerta = 'info';
                iconeAlerta = 'info-circle';
            }
            
            const dataEmissao = new Date(alerta.emitidoEm);
            const dataFormatada = dataEmissao.toLocaleString('pt-BR');
            
            let instrucoes = '';
            if (alerta.instrucoes && alerta.instrucoes.length > 0) {
              instrucoes = `
                <h6 class="mt-3 mb-2">Instruções:</h6>
                <ul class="mb-0">
                  ${alerta.instrucoes.map(instrucao => `<li>${instrucao}</li>`).join('')}
                </ul>
              `;
            }
            
            let abrigos = '';
            if (alerta.abrigos && alerta.abrigos.length > 0) {
              abrigos = `
                <h6 class="mt-3 mb-2">Abrigos disponíveis:</h6>
                <ul class="mb-0">
                  ${alerta.abrigos.map(abrigo => `<li>${abrigo}</li>`).join('')}
                </ul>
              `;
            }
            
            const alertaHTML = `
              <div class="alert alert-${classeAlerta} mb-3">
                <h5 class="alert-heading">
                  <i class="fas fa-${iconeAlerta} me-2"></i> ${alerta.titulo}
                </h5>
                <p>${alerta.descricao}</p>
                ${instrucoes}
                ${abrigos}
                <div class="mt-3 text-end">
                  <small>Emitido em: ${dataFormatada}</small>
                </div>
              </div>
            `;
            
            alertasEl.innerHTML += alertaHTML;
          });
        }
        
        // Função para processar alertas da API
        async function carregarAlertas() {
          console.log('Carregando alertas dos municípios...');
          
          try {
            // Adicionar timestamp para evitar cache
            const timestamp = new Date().getTime();
            const url = `https://sheetdb.io/api/v1/jhx7c3n5n0lkg/sheet/alertas?_=${timestamp}`;
            
            // Tentar fazer fetch com CORS
            console.log('Buscando alertas da API:', url);
            const resposta = await fetch(url, {
              method: 'GET',
              headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                'Cache-Control': 'no-cache',
                'Pragma': 'no-cache'
              },
              mode: 'cors',
              cache: 'no-cache'
            });
            
            if (!resposta.ok) {
              throw new Error(`Falha ao buscar alertas: ${resposta.status} ${resposta.statusText}`);
            }
            
            const dados = await resposta.json();
            console.log('Alertas recebidos da API:', dados);
            
            // Processar alertas
            const alertas = processarAlertas(dados);
            
            // Armazenar alertas para uso em outras funções
            window.alertasMunicipios = alertas;
            
            return alertas;
          } catch (erro) {
            console.error('Erro ao carregar alertas:', erro);
            
            // Tentar carregar alertas locais como fallback
            try {
              const respostaLocal = await fetch('alertas.json');
              if (respostaLocal.ok) {
                const dadosLocais = await respostaLocal.json();
                console.log('Alertas locais carregados com sucesso:', dadosLocais);
                const alertas = processarAlertas(dadosLocais);
                window.alertasMunicipios = alertas;
                return alertas;
              }
            } catch (erroLocal) {
              console.error('Falha ao carregar alertas locais:', erroLocal);
            }
            
            // Se chegou aqui, todas as tentativas falharam
            console.warn('Não foi possível carregar alertas. Usando array vazio.');
            window.alertasMunicipios = [];
            return [];
          }
        }
        
        // Função para processar alertas
        function processarAlertas(dados) {
          console.log('Processando alertas:', dados);
          
          if (!Array.isArray(dados)) {
            console.warn('Dados de alertas não são um array:', dados);
            return [];
          }
          
          // Processar cada alerta
          const alertas = dados.map((alerta, index) => {
            // Verificar dados essenciais
            const municipio = alerta.Municipio || alerta.municipio;
            if (!municipio) {
              console.warn(`Alerta #${index} sem município definido:`, alerta);
              return null;
            }
            
            // Gerar ID para o município
            const municipioId = gerarMunicipioId(municipio);
            
            return {
              id: alerta.ID || alerta.id || `alerta-${index}`,
              municipioId: municipioId,
              municipio: municipio,
              tipo: alerta.Tipo || alerta.tipo || 'informativo',
              nivel: alerta.Nivel || alerta.nivel || 'baixo',
              mensagem: alerta.Mensagem || alerta.mensagem || 'Alerta sem mensagem definida',
              dataInicio: alerta['Data Início'] || alerta.dataInicio || new Date().toISOString(),
              dataFim: alerta['Data Fim'] || alerta.dataFim || '',
              abrigos: alerta.Abrigos || alerta.abrigos || 0,
              instrucoes: alerta.Instrucoes || alerta.instrucoes || 'Siga as orientações da Defesa Civil local.'
            };
          }).filter(alerta => alerta !== null);
          
          console.log(`${alertas.length} alertas processados com sucesso`);
          return alertas;
        }
        
        // Inicializar carregamento de dados quando a página carregar
        document.addEventListener('DOMContentLoaded', async function() {
          console.log('Página carregada. Inicializando carregamento de dados...');
          
          // Carregar dados iniciais
          await carregarDados();
          
          // Configurar atualização automática a cada 5 minutos
          setInterval(async function() {
            console.log('Atualizando dados automaticamente...');
            await carregarDados();
          }, 5 * 60 * 1000); // 5 minutos
          
          // Configurar filtros
          const filtroRisco = document.getElementById('filtro-risco');
          if (filtroRisco) {
            filtroRisco.addEventListener('change', function() {
              const risco = this.value;
              filtrarMunicipiosPorRisco(risco);
            });
          }
          
          // Configurar busca
          const campoBusca = document.getElementById('busca-municipio');
          if (campoBusca) {
            campoBusca.addEventListener('input', function() {
              const termo = this.value.trim().toLowerCase();
              buscarMunicipios(termo);
            });
          }
          
          console.log('Inicialização concluída.');
        });
        
        // Função para depuração
        window.debugMunicipios = function() {
          console.log('=== DEPURAÇÃO DE MUNICÍPIOS ===');
          console.log('Municípios carregados:', window.dadosMunicipios);
          console.log('Alertas carregados:', window.alertasMunicipios);
          
          // Contar municípios por risco
          if (window.dadosMunicipios) {
            const riscos = Object.values(window.dadosMunicipios).reduce((acc, mun) => {
              acc[mun.risco] = (acc[mun.risco] || 0) + 1;
              return acc;
            }, {});
            console.log('Distribuição de risco:', riscos);
          }
          
          // Verificar elementos na página
          console.log('Container de municípios:', document.getElementById('lista-municipios'));
          console.log('Cards de municípios:', document.querySelectorAll('.municipio-card').length);
          
          return 'Depuração concluída. Verifique o console para mais detalhes.';
        };
        
        // Função para filtrar municípios por risco ou alertas
        function filtrarMunicipios(filtro) {
          const cards = document.querySelectorAll('.municipio-card');
          const semResultados = document.getElementById('mensagem-sem-resultados');
          
          let contadorVisivel = 0;
          
          cards.forEach(card => {
            const municipioId = card.getAttribute('data-municipio');
            const municipio = dadosMunicipios[municipioId];
            
            if (!municipio) {
              card.closest('.col-md-6').style.display = 'none';
              return;
            }
            
            let visivel = false;
            
            switch(filtro) {
              case 'alto':
                visivel = municipio.risco === 'alto';
                break;
              case 'medio':
                visivel = municipio.risco === 'medio';
                break;
              case 'baixo':
                visivel = municipio.risco === 'baixo';
                break;
              case 'com-alertas':
                visivel = dadosAlertas.some(alerta => alerta.municipioId === municipioId);
                break;
              default: // 'todos'
                visivel = true;
            }
            
            card.closest('.col-md-6').style.display = visivel ? 'block' : 'none';
            
            if (visivel) contadorVisivel++;
          });
          
          // Mostrar mensagem quando não houver resultados
          if (semResultados) {
            if (contadorVisivel === 0) {
              semResultados.style.display = 'block';
              semResultados.innerHTML = `
                <div class="alert alert-info text-center my-4">
                  <i class="fas fa-info-circle fa-2x mb-3"></i>
                  <h5>Nenhum município encontrado</h5>
                  <p class="mb-0">Não há municípios que correspondam ao filtro selecionado.</p>
                </div>
              `;
            } else {
              semResultados.style.display = 'none';
            }
          }
        }
        
        // Função para filtrar municípios por texto
        function filtrarMunicipiosPorTexto(texto) {
          const cards = document.querySelectorAll('.municipio-card');
          const semResultados = document.getElementById('mensagem-sem-resultados');
          
          let contadorVisivel = 0;
          
          cards.forEach(card => {
            const municipioId = card.getAttribute('data-municipio');
            const municipio = dadosMunicipios[municipioId];
            
            if (!municipio) {
              card.closest('.col-md-6').style.display = 'none';
              return;
            }
            
            const nomeMunicipio = municipio.nome.toLowerCase();
            const nomeRio = (municipio.rio || '').toLowerCase();
            
            const visivel = texto === '' || 
                          nomeMunicipio.includes(texto) || 
                          nomeRio.includes(texto);
            
            card.closest('.col-md-6').style.display = visivel ? 'block' : 'none';
            
            if (visivel) contadorVisivel++;
          });
          
          // Mostrar mensagem quando não houver resultados
          if (semResultados) {
            if (contadorVisivel === 0) {
              semResultados.style.display = 'block';
              semResultados.innerHTML = `
                <div class="alert alert-info text-center my-4">
                  <i class="fas fa-search fa-2x mb-3"></i>
                  <h5>Nenhum município encontrado</h5>
                  <p class="mb-0">Não foram encontrados municípios que correspondam à sua busca.</p>
                </div>
              `;
            } else {
              semResultados.style.display = 'none';
            }
          }
        }
        
        // Função para criar HTML de um card de município
        function criarCardMunicipio(municipioId, municipio) {
          console.log(`Criando card para município: ${municipio.nome} (${municipioId})`);
          
          // Determinar classe de risco
          let classeRisco, iconeRisco, textoRisco;
          switch(municipio.risco) {
            case 'alto':
              classeRisco = 'danger';
              iconeRisco = 'exclamation-triangle';
              textoRisco = 'Alto';
              break;
            case 'medio':
              classeRisco = 'warning';
              iconeRisco = 'exclamation-circle';
              textoRisco = 'Médio';
              break;
            default:
              classeRisco = 'success';
              iconeRisco = 'check-circle';
              textoRisco = 'Baixo';
          }
          
          // Determinar classe e ícone de tendência
          let iconeTendencia, classeTendencia;
          switch(municipio.tendencia) {
            case 'subindo':
              iconeTendencia = 'fa-arrow-up';
              classeTendencia = 'text-danger';
              break;
            case 'descendo':
              iconeTendencia = 'fa-arrow-down';
              classeTendencia = 'text-success';
              break;
            default:
              iconeTendencia = 'fa-arrows-alt-h';
              classeTendencia = 'text-warning';
          }
          
          // Formatar variação
          const sinal = municipio.variacao24h > 0 ? '+' : '';
          const variacaoTexto = `${sinal}${municipio.variacao24h.toFixed(2)}m em 24h`;
          
          // Verificar estrutura dos dados
          const rio = municipio.rio || "não informado";
          const nivelAtual = isNaN(municipio.nivelAtual) ? 0 : municipio.nivelAtual;
          const dataAtualizacao = formatarData(municipio.atualizadoEm || new Date().toISOString());
          
          // Escapar texto para HTML
          const escaparHTML = (str) => String(str)
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#039;');
          
          // Gerar HTML do card conforme estrutura do site
          return `
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="card h-100 municipio-card" data-municipio="${escaparHTML(municipioId)}" onclick="abrirModal('${escaparHTML(municipioId)}')">
                <div class="card-header bg-${classeRisco} text-white">
                  <h5 class="card-title mb-0">
                    <i class="fas fa-map-marker-alt me-2"></i> ${escaparHTML(municipio.nome)}
                  </h5>
                </div>
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <span class="text-muted">Rio ${escaparHTML(rio)}</span>
                    <span class="badge bg-${classeRisco}">
                      <i class="fas fa-${iconeRisco} me-1"></i> Risco ${textoRisco}
                    </span>
                  </div>
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <h3 class="mb-0" data-nivel>${nivelAtual.toFixed(2)}m</h3>
                      <small class="text-muted">Nível atual</small>
                    </div>
                    <div class="text-end">
                      <span class="d-block" data-tendencia id="tendencia-${escaparHTML(municipioId)}">
                        <i class="fas ${iconeTendencia} ${classeTendencia}"></i> ${municipio.tendencia.charAt(0).toUpperCase() + municipio.tendencia.slice(1)}
                      </span>
                      <small class="text-muted" data-variacao id="variacao-${escaparHTML(municipioId)}">
                        ${variacaoTexto}
                      </small>
                    </div>
                  </div>
                </div>
                <div class="card-footer bg-light">
                  <small class="text-muted">
                    <i class="far fa-clock me-1"></i> Atualizado: <span data-atualizacao id="atualizacao-${escaparHTML(municipioId)}">${dataAtualizacao}</span>
                  </small>
                </div>
              </div>
            </div>
          `;
        }
        
        // Função para calcular a porcentagem do nível do rio
        function calcularPorcentagemNivel(municipio) {
          // Calcular porcentagem com base no nível de inundação
          return Math.min(100, (municipio.nivelAtual / municipio.nivelInundacao) * 100);
        }
        
        // Função para atualizar contador de alertas
        function atualizarContadorAlertas() {
          const contador = document.querySelector('.alerta-contador');
          if (contador) {
            contador.textContent = dadosAlertas.length.toString();
            contador.style.display = dadosAlertas.length > 0 ? 'inline' : 'none';
          }
        }
        
        // Função para filtrar municípios por risco
        function filtrarMunicipiosPorRisco(risco) {
          console.log(`Filtrando municípios por risco: ${risco}`);
          
          const cards = document.querySelectorAll('.municipio-card');
          
          if (risco === 'todos') {
            // Mostrar todos os cards
            cards.forEach(card => {
              card.closest('.col-md-6').style.display = 'block';
            });
          } else {
            // Filtrar por risco
            cards.forEach(card => {
              const cardRisco = card.querySelector('.badge')?.textContent?.toLowerCase() || '';
              const mostrar = risco === 'todos' || cardRisco.includes(risco.toLowerCase());
              card.closest('.col-md-6').style.display = mostrar ? 'block' : 'none';
            });
          }
          
          // Verificar se há resultados
          const cardsVisiveis = document.querySelectorAll('.municipio-card[style*="display: block"]').length;
          const mensagemSemResultados = document.getElementById('mensagem-sem-resultados');
          
          if (cardsVisiveis === 0 && mensagemSemResultados) {
            mensagemSemResultados.style.display = 'block';
          } else if (mensagemSemResultados) {
            mensagemSemResultados.style.display = 'none';
          }
          
          console.log(`Filtro aplicado: ${cardsVisiveis} municípios visíveis`);
        }
        
        // Função para buscar municípios por texto
        function buscarMunicipios(termo) {
          console.log(`Buscando municípios com termo: "${termo}"`);
          
          const cards = document.querySelectorAll('.municipio-card');
          let encontrados = 0;
          
          cards.forEach(card => {
            const titulo = card.querySelector('.card-title')?.textContent?.toLowerCase() || '';
            const rio = card.querySelector('.text-muted')?.textContent?.toLowerCase() || '';
            const mostrar = termo === '' || titulo.includes(termo) || rio.includes(termo);
            
            card.closest('.col-md-6').style.display = mostrar ? 'block' : 'none';
            
            if (mostrar) encontrados++;
          });
          
          // Verificar se há resultados
          const mensagemSemResultados = document.getElementById('mensagem-sem-resultados');
          
          if (encontrados === 0 && mensagemSemResultados) {
            mensagemSemResultados.style.display = 'block';
            mensagemSemResultados.innerHTML = `
              <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                Nenhum município encontrado com o termo "${termo}".
              </div>
            `;
          } else if (mensagemSemResultados) {
            mensagemSemResultados.style.display = 'none';
          }
          
          console.log(`Busca concluída: ${encontrados} municípios encontrados`);
        }
    </script>
    
    <!-- Script para corrigir a navegação entre abas -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Corrigir navegação entre abas
            const navLinks = document.querySelectorAll('.nav-link[data-bs-toggle="tab"]');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetTab = this.getAttribute('href');
                    
                    // Remover classe active de todas as abas
                    document.querySelectorAll('.nav-link').forEach(tab => {
                        tab.classList.remove('active');
                        tab.setAttribute('aria-selected', 'false');
                    });
                    
                    // Adicionar classe active à aba clicada
                    this.classList.add('active');
                    this.setAttribute('aria-selected', 'true');
                    
                    // Esconder todos os painéis de conteúdo
                    document.querySelectorAll('.tab-pane').forEach(pane => {
                        pane.classList.remove('show', 'active');
                    });
                    
                    // Mostrar o painel de conteúdo correspondente
                    const targetPane = document.querySelector(targetTab);
                    if (targetPane) {
                        targetPane.classList.add('show', 'active');
                    }
                });
            });
            
            // Também corrigir links no rodapé
            const footerLinks = document.querySelectorAll('.footer-link[data-bs-toggle="tab"]');
            footerLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetTab = this.getAttribute('href');
                    
                    // Encontrar o link correspondente na navegação principal e clicar nele
                    const navLink = document.querySelector(`.nav-link[href="${targetTab}"]`);
                    if (navLink) {
                        navLink.click();
                    }
                });
            });
        });
    </script>
</body>
</html>
